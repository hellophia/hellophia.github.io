<!DOCTYPE html>
<html>
<head>
    <title>jobsites</title>
    <style>
	
		@import url('https://fonts.googleapis.com/css2?family=Noto+Serif&display=swap');
		
		body {
		  	font-size: 14px;
		  	font-family: "Noto Serif";
		  	background-color: #212121;
		}
        #map {
            height: 400px;
            width: 80%;
			margin: 40px auto;
        }
		#tags {
			margin:20px;
		}
	    input[type="checkbox"] {
	      width: 20px;
	      height: 20px;
		  margin-right:6px;
		  vertical-align: middle;
	    }
		label{
			margin-left:16px;
			color: #e3e3e3;
		}
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="tags"></div>

    <script>
		
		const mapdata = [
			{
			"contractor": "A & S CEMENT CONTRACTORS INC",
			"address": "530 South Olive Street, Los Angeles, ,",
			"type": ["Commercial - Concrete"],
			},
			{
			"contractor": "ABDELLATIF ENTERPRISES, INC.",
			"address": "316 North Juanita Avenue, Los Angeles, ,",
			"type": ["Framing Residential", " Wood Framing"],
			},
			{
			"contractor": "ANNING - JOHNSON COMPANY",
			"address": "3625 South Grand Avenue, Los Angeles, CA, 90007",
			"type": ["Dry Fin Com", " Drywall", " Drywall Com", "Metal Stud/Framing"],
			},
			{
			"contractor": "ANNING - JOHNSON COMPANY",
			"address": "4701 South Santa Fe Avenue, Vernon, ,",
			"type": ["Drywall", " Drywall Com"],
			},
			{
			"contractor": "BAYLEY CONSTRUCTION",
			"address": "8500 Beverly Boulevard, Los Angeles, CA, 90048",
			"type": ["Commercial - Concrete"],
			},
			{
			"contractor": "CHURCH & LARSEN INC",
			"address": "16103 Avenida Padilla, Irwindale, CA, 91702",
			"type": ["Commercial - Concrete", " Commercial - Lathe", " Drywall", " Drywall Com", "Lath/Plaster/EIFS"],
			},
			{
			"contractor": "GONSALVES & SANTUCCI INC dba CONCO",
			"address": "590 South Fair Oaks Avenue, Pasadena, CA, 91105",
			"type": ["Commercial - Concrete"],
			},
			{
			"contractor": "GONSALVES & SANTUCCI INC dba CONCO",
			"address": "510 West 6th Street, Los Angeles, CA, 90014",
			"type": ["Commercial - Concrete", " Concrete - Horizontal Decks", " Concrete - VerticalConcrete", " General Contractor"],
			},
		]
			
		var map;
		var markers = [];

		function initMap() {
		    map = new google.maps.Map(document.getElementById('map'), {
		        center: {lat: 34.05, lng: -118.255},
		        zoom: 10
		    });
			
		    parseAndPlotMarkers();
		}
		
		function parseAndPlotMarkers() {
			mapdata.forEach(function(entry) {
				// Parse address to latitude and longitude using Geocoding API
				var geocoder = new google.maps.Geocoder();
				geocoder.geocode({
					'address': entry.address
				}, function(results, status) {
					if (status === 'OK') {
						var location = results[0].geometry.location;
						var marker = new google.maps.Marker({
							position: location,
							map: map,
							title: entry.contractor
						});

						// Construct content for the popup including contractor, address, and types of work
						var contentString = '<div><strong>' + entry.contractor + '</strong><br>' + entry.address + '<br><ul>';
						entry.type.forEach(function(workType) {
							contentString += '<li>' + workType + '</li>';
						});
						contentString += '</ul></div>';

						// Attach click listener to the marker to show details when clicked
						var infowindow = new google.maps.InfoWindow({
							content: contentString
						});
						marker.addListener('click', function() {
							// Close all currently open popups before opening a new one
							markers.forEach(function(existingMarker) {
								existingMarker.infowindow.close();
							});
							// Open the popup for the clicked marker
							infowindow.open(map, marker);
						});

						// Store marker reference for toggling later
						markers.push({
							marker: marker,
							infowindow: infowindow
						});
					} else {
						console.error('Geocode was not successful for the following reason: ' + status);
					}
				});
			});
		}
		
		function generateCheckboxes() {
		    // Get all unique types of work from the JSON data
		    var allTypes = [];
		    mapdata.forEach(function(entry) {
		        entry.type.forEach(function(workType) {
		            if (!allTypes.includes(workType)) {
		                allTypes.push(workType);
		            }
		        });
		    });

		    // Generate checkboxes for each type of work
		    var checkboxesContainer = document.getElementById('tags');
		    allTypes.forEach(function(workType) {
		        var checkbox = document.createElement('input');
		        checkbox.type = 'checkbox';
		        checkbox.value = workType;
		        checkbox.id = 'checkbox_' + workType.replace(/\s/g, '_'); // Replace spaces with underscores for IDs
		        var label = document.createElement('label');
		        label.appendChild(checkbox);
		        label.appendChild(document.createTextNode(workType));
		        checkboxesContainer.appendChild(label);
		    });

		    // Add event listener to checkboxes to toggle markers
		    checkboxesContainer.querySelectorAll('input[type="checkbox"]').forEach(function(checkbox) {
		        checkbox.addEventListener('change', function() {
		            toggleMarkers(this.value);
		        });
		    });
		}
		
		window.addEventListener('load', generateCheckboxes);
		
		// Function to toggle markers based on selected tags
		function toggleMarkers(workType) {
		    // Loop through all markers
		    markers.forEach(function(markerData) {
		        var marker = markerData.marker;
		        var infowindow = markerData.infowindow;
		        var isVisible = false;
        
		        // Check if the marker matches the selected work type
		        if (marker.workType.includes(workType)) {
		            isVisible = true;
		        }
        
		        // Show or hide the marker based on visibility
		        marker.setVisible(isVisible);
        
		        // Close the infowindow associated with the marker
		        infowindow.close();
		    });
		}
        
    </script>

    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDsRfnkiV2jKntdBPNp8eNIelohLCLUXw4&callback=initMap">
    </script>
		
</body>
</html>