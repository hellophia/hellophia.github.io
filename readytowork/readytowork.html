<!DOCTYPE html>
<html>
<head>
    <title>jobsites</title>
    <style>
        #map {
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="tags">
        <label><input type="checkbox" value="drywall"> Drywall</label>
        <label><input type="checkbox" value="acoustical"> Acoustical</label>
        <label><input type="checkbox" value="woodframing"> Wood Framing</label>
    </div>

    <script>
		
		const mapdata = [
			{
			"contractor": "ANNING - JOHNSON COMPANY",
			"address": "3625 South Grand Avenue, Los Angeles, CA, 90007",
			"type": ["Dry Fin Com", " Drywall", " Drywall Com", "Metal Stud/Framing"]
			},
			{
			"contractor": "BAYLEY CONSTRUCTION",
			"address": "8500 Beverly Boulevard, Los Angeles, CA, 90048",
			"type": ["Commercial - Concrete"]
			}
		]
			
		var map;
		var markers = [];

		function initMap() {
		    map = new google.maps.Map(document.getElementById('map'), {
		        center: {lat: 34.05, lng: -118.255},
		        zoom: 10
		    });
			
		    parseAndPlotMarkers();
		}
		
		function parseAndPlotMarkers() {
			mapdata.forEach(function(entry) {
				// Parse address to latitude and longitude using Geocoding API
				var geocoder = new google.maps.Geocoder();
				geocoder.geocode({
					'address': entry.address
				}, function(results, status) {
					if (status === 'OK') {
						var location = results[0].geometry.location;
						var marker = new google.maps.Marker({
							position: location,
							map: map,
							title: entry.contractor
						});

						// Construct content for the popup including contractor, address, and types of work
						var contentString = '<div><strong>' + entry.contractor + '</strong><br>' + entry.address + '<br><ul>';
						entry.type.forEach(function(workType) {
							contentString += '<li>' + workType + '</li>';
						});
						contentString += '</ul></div>';

						// Attach click listener to the marker to show details when clicked
						var infowindow = new google.maps.InfoWindow({
							content: contentString
						});
						marker.addListener('click', function() {
							// Close all currently open popups before opening a new one
							markers.forEach(function(existingMarker) {
								existingMarker.infowindow.close();
							});
							// Open the popup for the clicked marker
							infowindow.open(map, marker);
						});

						// Store marker reference for toggling later
						markers.push({
							marker: marker,
							infowindow: infowindow
						});
					} else {
						console.error('Geocode was not successful for the following reason: ' + status);
					}
				});
			});
		}
		
		// Function to toggle markers based on selected tags
		function toggleMarkers(tag) {
		    // Toggle visibility of markers based on selected tag
		}

		// Event listener to toggle markers when checkboxes are clicked
		document.querySelectorAll('#tags input[type="checkbox"]').forEach(function(checkbox) {
		    checkbox.addEventListener('change', function() {
		        toggleMarkers(this.value);
		    });
		});
        
    </script>

    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDsRfnkiV2jKntdBPNp8eNIelohLCLUXw4&callback=initMap">
    </script>
		
</body>
</html>