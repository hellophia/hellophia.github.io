<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<body>

<button onclick="speak()">Speak</button>

<audio id="audio" controls>
  Your browser does not support the audio element.
</audio>

<div id="textList">
  <div>
    <input type="checkbox" id="checkbox1" checked>
    <label for="checkbox1">Text 1:</label>
    <span>This is the first text to be read.</span>
  </div>
  <div>
    <input type="checkbox" id="checkbox2" checked>
    <label for="checkbox2">Text 2:</label>
    <span>This is the second text to be read.</span>
  </div>
  <div>
    <input type="checkbox" id="checkbox3" checked>
    <label for="checkbox3">Text 3:</label>
    <span>This is the third text to be read.</span>
  </div>
</div>

<script>
	
  fetch('data.tsv')
    .then(response => response.text())
    .then(data => {
      const lines = data.split('\n').slice(1);
      const items = lines.map(line => {
        const [stretch, switchVal, time, reps, group] = line.split('\t');
        return { stretch, switch: switchVal, time, reps: parseInt(reps), group };
      });
      console.log(items);
    })
    .catch(error => console.error('Error fetching the data:', error));
	
	function speak() {
		var textList = document.querySelectorAll("#textList div");
		var ssml = '<speak>';

		textList.forEach(function(item, index) {
		var checkbox = item.querySelector("input[type='checkbox']");
		var text = item.querySelector("span").textContent.trim();

		if (checkbox.checked) {
		  ssml += text + ' ';
		}
		});

		ssml += '</speak>';

		var xhr = new XMLHttpRequest();
		var url = "https://texttospeech.googleapis.com/v1/text:synthesize?key=AIzaSyCcCQFbNls8ogpWJTshCm2ZTQLnx1x3tzE";

	    xhr.open("POST", url, true);
	    xhr.setRequestHeader("Content-Type", "application/json");

	    xhr.onreadystatechange = function () {
	      if (xhr.readyState === 4 && xhr.status === 200) {
	        var response = JSON.parse(xhr.responseText);
	        var audioUrl = "data:audio/mp3;base64," + response.audioContent;
	        document.getElementById("audio").src = audioUrl;
	        document.getElementById("audio").play();
	      }
	    };

	    var data = JSON.stringify({
	      input: { ssml: ssml },
	      voice: { languageCode: "en-US", ssmlGender: "NEUTRAL" },
	      audioConfig: { audioEncoding: "MP3" }
	    });

	    xhr.send(data);
	}

</script>

</body>
</html>
