<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<body>

<button onclick="speak()">Speak</button>

<audio id="audio" controls>
  Your browser does not support the audio element.
</audio>

<div id="stretchList">

</div>

<script>
	
  fetch('data.tsv')
    .then(response => response.text())
    .then(data => {
      const lines = data.split('\n').slice(1);
      const items = lines.map(line => {
        const [stretch, switchVal, time, reps, group] = line.split('\t');
        return { stretch, switch: switchVal, time, reps: parseInt(reps), group };
      });
      console.log(items);
    })
    .catch(error => console.error('Error fetching the data:', error));
	
	function createElements() {
	  const stretchList = document.getElementById('stretchList');

	  data.forEach(item => {
	    const div = document.createElement('div');
    
	    const checkbox = document.createElement('input');
	    checkbox.type = 'checkbox';
	    checkbox.checked = true;
	    div.appendChild(checkbox);
    
	    const label = document.createElement('label');
	    label.textContent = item.stretch;
	    div.appendChild(label);
    
	    stretchList.appendChild(div);
	  });
	}
	
	function speak() {
		var textList = document.querySelectorAll("#stretchList div");
		var ssml = '<speak>';

		textList.forEach(item => {
		    const checkbox = item.querySelector("input[type='checkbox']");
		    const text = item.querySelector("label").textContent.trim();

		    if (checkbox.checked) {
		      ssml += text + ' ';
		    }
		  });

		ssml += '</speak>';

		var xhr = new XMLHttpRequest();
		var url = "https://texttospeech.googleapis.com/v1/text:synthesize?key=AIzaSyCcCQFbNls8ogpWJTshCm2ZTQLnx1x3tzE";

	    xhr.open("POST", url, true);
	    xhr.setRequestHeader("Content-Type", "application/json");

	    xhr.onreadystatechange = function () {
	      if (xhr.readyState === 4 && xhr.status === 200) {
	        var response = JSON.parse(xhr.responseText);
	        var audioUrl = "data:audio/mp3;base64," + response.audioContent;
	        document.getElementById("audio").src = audioUrl;
	        document.getElementById("audio").play();
	      }
	    };

	    var data = JSON.stringify({
	      input: { ssml: ssml },
	      voice: { languageCode: "en-US", ssmlGender: "NEUTRAL" },
	      audioConfig: { audioEncoding: "MP3" }
	    });

	    xhr.send(data);
	}
	
	window.onload = createElements;

</script>

</body>
</html>
